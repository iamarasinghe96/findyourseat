<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Your Seat - Guvani & Indika</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      position: relative;
      min-height: 100vh;
      overflow: hidden;
    }

    .background-overlay {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100%;
      background-image: url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=1950&q=80');
      background-size: cover;
      background-position: center;
      filter: brightness(40%);
      z-index: -1;
    }

    .content {
      position: relative;
      z-index: 1;
      padding: 50px 20px;
      color: white;
      text-align: center;
    }

    h1 {
      font-family: 'Brush Script MT', cursive;
      font-size: 3em;
      margin-bottom: 0;
    }

    h2 {
      font-size: 1.5em;
      margin-top: 5px;
      font-weight: 300;
    }

    #searchBox {
      margin-top: 40px;
      padding: 10px;
      width: 80%;
      max-width: 400px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }

    #result {
      margin-top: 30px;
      font-size: 18px;
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
      max-width: 90%;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="background-overlay"></div>
  <div class="content">
    <h1>Guvani & Indika</h1>
    <h2>Find your seat</h2>
    <input type="text" id="searchBox" placeholder="Search your name..." oninput="searchGuest()" list="guests" autocomplete="off" />
    <datalist id="guests"></datalist>
    <div id="result"></div>
  </div>

  <script>
    let guestsData = [];

    async function fetchData() {
      const response = await fetch('https://sheetdb.io/api/v1/s40b3e26yad0v');
      const data = await response.json();
      guestsData = data;
      populateDatalist(data);
    }

    function populateDatalist(data) {
      const datalist = document.getElementById('guests');
      datalist.innerHTML = "";
      data.forEach(item => {
        const option = document.createElement('option');
        option.value = item["Name"];
        datalist.appendChild(option);
      });
    }

    function normalizeName(name) {
      return name.toLowerCase().replace(/^(dr\.?|mrs\.?|mr\.?)\s+/i, '').trim();
    }

    function searchGuest() {
      const inputRaw = document.getElementById('searchBox').value;
      const input = normalizeName(inputRaw);
      const guest = guestsData.find(g => normalizeName(g["Name"]) === input);

      if (guest) {
        const tableNumber = guest["Table Number"];
        const tableMates = guestsData
          .filter(g => g["Table Number"] === tableNumber)
          .map(g => g["Name"])
          .filter(name => normalizeName(name) !== input);

        document.getElementById('result').innerHTML =
          `<strong>Your table number is:</strong> ${tableNumber}<br><br>` +
          (tableMates.length > 0
            ? `<strong>You will be seated with:</strong><br>${tableMates.join(', ')}`
            : `<strong>You are currently the only one at this table.</strong>`);
      } else {
        document.getElementById('result').innerHTML = "";
      }
    }

    fetchData();
  </script>
</body>
</html>
